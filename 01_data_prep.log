------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\CTilley\Projects\portugal\01_data_prep.log
  log type:  text
 opened on:  25 Oct 2021, 07:42:31

. 
. /*
>  PROGRAM: 01_data_prep
>  PURPOSE: Combine data, define constructs
> */
. 
. local in_mat  `root'\src\raw\student-mat.csv

. local in_por  `root'\src\raw\student-por.csv

. local out_csv `root'\src\final\student.csv

. local out_dta `root'\src\final\student.dta

. 
. adopath ++ "`root'/ado"
  [1]              "C:\Users\CTilley\Projects\portugal/ado"
  [2]              "C:\Users\CTilley\Projects\ado_mpr"
  [3]  (BASE)      "C:\Program Files\Stata16\ado\base/"
  [4]  (SITE)      "C:\Program Files\Stata16\ado\site/"
  [5]              "."
  [6]  (PERSONAL)  "C:\Users\CTilley\ado\personal/"
  [7]  (PLUS)      "c:\ado\plus/"
  [8]  (OLDPLACE)  "c:\ado/"

. 
. 
. /* load raw data */
. foreach s in mat por {
  2.   
.   import delimited using "`in_`s''", clear varnames(1) case(preserve)
  3. 
.   * expected number of fields
.   assert `c(k)'==33
  4. 
.   * subject flag
.   gen subj = "`s'"
  5. 
.   * no identifier in raw files, verify each row is unique
.   isid *
  6. 
.   gen pseudo_id = _n
  7.     // only unique within subject
. 
.   tempfile `s'
  8.   save   "``s''"
  9. 
. }
(33 vars, 395 obs)
file C:\Users\CTilley\AppData\Local\Temp\ST_3384_000001.tmp saved
(33 vars, 649 obs)
file C:\Users\CTilley\AppData\Local\Temp\ST_3384_000002.tmp saved

. 
. 
. /* append frames */
. use "`mat'", clear

. 
. append using "`por'"

. 
. tablist subj, sort(v) ab(32)

  +--------------------------------------------+
  | subj   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------|
  |  mat      395    37.84       395     37.84 |
  |  por      649    62.16      1044    100.00 |
  +--------------------------------------------+

. 
. 
. /* constructs */
. 
. * no missingness in data frame
. mdesc *

    Variable    |     Missing          Total     Percent Missing
----------------+-----------------------------------------------
         school |           0          1,044           0.00
            sex |           0          1,044           0.00
            age |           0          1,044           0.00
        address |           0          1,044           0.00
        famsize |           0          1,044           0.00
        Pstatus |           0          1,044           0.00
           Medu |           0          1,044           0.00
           Fedu |           0          1,044           0.00
           Mjob |           0          1,044           0.00
           Fjob |           0          1,044           0.00
         reason |           0          1,044           0.00
       guardian |           0          1,044           0.00
     traveltime |           0          1,044           0.00
      studytime |           0          1,044           0.00
       failures |           0          1,044           0.00
      schoolsup |           0          1,044           0.00
         famsup |           0          1,044           0.00
           paid |           0          1,044           0.00
     activities |           0          1,044           0.00
        nursery |           0          1,044           0.00
         higher |           0          1,044           0.00
       internet |           0          1,044           0.00
       romantic |           0          1,044           0.00
         famrel |           0          1,044           0.00
       freetime |           0          1,044           0.00
          goout |           0          1,044           0.00
           Dalc |           0          1,044           0.00
           Walc |           0          1,044           0.00
         health |           0          1,044           0.00
       absences |           0          1,044           0.00
             G1 |           0          1,044           0.00
             G2 |           0          1,044           0.00
             G3 |           0          1,044           0.00
           subj |           0          1,044           0.00
      pseudo_id |           0          1,044           0.00
----------------+-----------------------------------------------

. assert wordcount("`r(notmiss_vars)'")==`c(k)'

. 
. * school
. assert inlist(school, "GP", "MS")

. 
. gen school_GP = school=="GP"

. 
. tablist school_GP school, sort(v) ab(32)

  +----------------------------------------------------------+
  | school_GP   school   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------|
  |         0       MS      272    26.05       272     26.05 |
  |         1       GP      772    73.95      1044    100.00 |
  +----------------------------------------------------------+

. 
. rename school __school

. 
. * gender
. assert inlist(sex, "F", "M")

. 
. gen female = sex=="F"

. 
. tablist female sex, sort(v) ab(32)

  +----------------------------------------------------+
  | female   sex   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------|
  |      0     M      453    43.39       453     43.39 |
  |      1     F      591    56.61      1044    100.00 |
  +----------------------------------------------------+

. 
. rename sex __sex

. 
. * age
. assert inrange(age, 15, 22)

. 
. summ age

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |      1,044    16.72605    1.239975         15         22

. 
. * urbanicity
. assert inlist(address, "U", "R")

. 
. gen urban = address=="U"

. 
. tablist urban address, sort(v) ab(32)

  +-------------------------------------------------------+
  | urban   address   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------|
  |     0         R      285    27.30       285     27.30 |
  |     1         U      759    72.70      1044    100.00 |
  +-------------------------------------------------------+

. 
. rename address __address

. 
. * family size
. assert inlist(famsize, "LE3", "GT3")

. 
. gen famsize_4plus = famsize=="GT3"

. 
. tablist famsize_4plus famsize, sort(v) ab(32)

  +---------------------------------------------------------------+
  | famsize_4plus   famsize   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |---------------------------------------------------------------|
  |             0       LE3      306    29.31       306     29.31 |
  |             1       GT3      738    70.69      1044    100.00 |
  +---------------------------------------------------------------+

. 
. rename famsize __famsize

. 
. * parent cohabitation status
. assert inlist(Pstatus, "T", "A")

. 
. gen par_together = Pstatus=="T"

. 
. tablist par_together Pstatus, sort(v) ab(32)

  +--------------------------------------------------------------+
  | par_together   Pstatus   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------|
  |            0         A      121    11.59       121     11.59 |
  |            1         T      923    88.41      1044    100.00 |
  +--------------------------------------------------------------+

. 
. rename Pstatus __Pstatus

. 
. * [mother/father] education
. foreach g in m f {
  2. 
.   local G = strupper("`g'")
  3. 
.   assert inlist(`G'edu, 0, 1, 2, 3, 4)
  4. 
.   gen `g'_edu_coll = `G'edu==4
  5.     // 0-3 = less than college
.     // 4   = college
. 
.   tablist `g'_edu_coll `G'edu, sort(v) ab(32)
  6. 
.   rename `G'edu __`G'edu
  7. 
. }

  +---------------------------------------------------------+
  | m_edu_coll   Medu   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |---------------------------------------------------------|
  |          0      0        9     0.86         9      0.86 |
  |          0      1      202    19.35       211     20.21 |
  |          0      2      289    27.68       500     47.89 |
  |          0      3      238    22.80       738     70.69 |
  |          1      4      306    29.31      1044    100.00 |
  +---------------------------------------------------------+

  +---------------------------------------------------------+
  | f_edu_coll   Fedu   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |---------------------------------------------------------|
  |          0      0        9     0.86         9      0.86 |
  |          0      1      256    24.52       265     25.38 |
  |          0      2      324    31.03       589     56.42 |
  |          0      3      231    22.13       820     78.54 |
  |          1      4      224    21.46      1044    100.00 |
  +---------------------------------------------------------+

. 
. * [mother/father] occupation
. foreach g in m f {
  2. 
.   local G = strupper("`g'")
  3. 
.   assert inlist(`G'job, "teacher", "health", "services", "at_home", "other")
  4.     // teacher = teacher
.     // health care
.     // civil services
.     // stay-at-home
.     // other
. 
.   foreach lev in teacher health services at_home other {
  5. 
.     gen `g'_job_`lev' = `G'job=="`lev'"
  6. 
.   }
  7. 
.   capture drop __validate
  8.   egen         __validate = rowtotal(`g'_job_*)
  9.   assert       __validate==1
 10. 
.   tablist `g'_job_* `G'job, sort(v) ab(32)
 11. 
.   rename `G'job __`G'job
 12. 
. }

  +------------------------------------------------------------------------------------------------------------------------------+
  | m_job_teacher   m_job_health   m_job_services   m_job_at_home   m_job_other       Mjob   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------------------------------------------------------------------|
  |             0              0                0               0             1      other      399    38.22       399     38.22 |
  |             0              0                0               1             0    at_home      194    18.58       593     56.80 |
  |             0              0                1               0             0   services      239    22.89       832     79.69 |
  |             0              1                0               0             0     health       82     7.85       914     87.55 |
  |             1              0                0               0             0    teacher      130    12.45      1044    100.00 |
  +------------------------------------------------------------------------------------------------------------------------------+

  +------------------------------------------------------------------------------------------------------------------------------+
  | f_job_teacher   f_job_health   f_job_services   f_job_at_home   f_job_other       Fjob   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------------------------------------------------------------------|
  |             0              0                0               0             1      other      584    55.94       584     55.94 |
  |             0              0                0               1             0    at_home       62     5.94       646     61.88 |
  |             0              0                1               0             0   services      292    27.97       938     89.85 |
  |             0              1                0               0             0     health       41     3.93       979     93.77 |
  |             1              0                0               0             0    teacher       65     6.23      1044    100.00 |
  +------------------------------------------------------------------------------------------------------------------------------+

. 
. * reason to choose school
. assert inlist(reason, "home", "reputation", "course", "other")

.   // close to home
.   // school reputation
.   // course preferences
.   // other
. 
. gen sch_close = reason=="home"

.   // splitting based on school proximity versus all other factors
. 
. tablist sch_close reason, sort(v) ab(32)

  +--------------------------------------------------------------+
  | sch_close       reason   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------|
  |         0       course      430    41.19       430     41.19 |
  |         0        other      108    10.34       538     51.53 |
  |         0   reputation      248    23.75       786     75.29 |
  |         1         home      258    24.71      1044    100.00 |
  +--------------------------------------------------------------+

. 
. rename reason __reason

. 
. * guardian
. assert inlist(guardian, "mother", "father", "other")

.   // unclear exact definition of field
.   // perhaps primary point-of-contact for school?
. 
. gen guardian_m = guardian=="mother"

. gen guardian_f = guardian=="father"

. gen guardian_o = guardian=="other"

. 
. assert guardian_m + guardian_f + guardian_o == 1

. 
. tablist guardian_* guardian, sort(v) ab(32)

  +---------------------------------------------------------------------------------------+
  | guardian_m   guardian_f   guardian_o   guardian   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |---------------------------------------------------------------------------------------|
  |          0            0            1      other       73     6.99        73      6.99 |
  |          0            1            0     father      243    23.28       316     30.27 |
  |          1            0            0     mother      728    69.73      1044    100.00 |
  +---------------------------------------------------------------------------------------+

. 
. rename guardian __guardian

. 
. * travel time to school
. assert inlist(traveltime, 1, 2, 3, 4)

.   // 1 = < 15 min
.   // 2 = 15 to 30 min
.   // 3 = 30 min to 1 hour
.   // 4 = 1 hour
. 
. gen sch_trvl_time_ge15m = inlist(traveltime, 2, 3, 4)

. 
. assert (traveltime==1) + sch_trvl_time_ge15m == 1

. 
. tablist sch_trvl_time_ge15m traveltime, sort(v) ab(32)

  +------------------------------------------------------------------------+
  | sch_trvl_time_ge15m   traveltime   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------------|
  |                   0            1      623    59.67       623     59.67 |
  |                   1            2      320    30.65       943     90.33 |
  |                   1            3       77     7.38      1020     97.70 |
  |                   1            4       24     2.30      1044    100.00 |
  +------------------------------------------------------------------------+

. 
. rename traveltime __traveltime

. 
. * weekly study time
. assert inlist(studytime, 1, 2, 3, 4)

.   // 1 = < 2 hours
.   // 2 = 2 to 5 hours
.   // 3 = 5 to 10 hours
.   // 4 = 10+ hours
. 
. gen wk_study_hrs_lt2   = studytime==1

. gen wk_study_hrs_2to5  = studytime==2

. gen wk_study_hrs_5plus = inlist(studytime, 3, 4)

. 
. assert wk_study_hrs_lt2 + wk_study_hrs_2to5 + wk_study_hrs_5plus == 1

. 
. tablist wk_study_* studytime, sort(v) ab(32)

  +-------------------------------------------------------------------------------------------------------------+
  | wk_study_hrs_lt2   wk_study_hrs_2to5   wk_study_hrs_5plus   studytime   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------------------------------------------------------|
  |                0                   0                    1           3      162    15.52       162     15.52 |
  |                0                   0                    1           4       62     5.94       224     21.46 |
  |                0                   1                    0           2      503    48.18       727     69.64 |
  |                1                   0                    0           1      317    30.36      1044    100.00 |
  +-------------------------------------------------------------------------------------------------------------+

. 
. rename studytime __studytime

. 
. * number of past class failures
. assert inlist(failures, 0, 1, 2, 3)

. 
. summ failures

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    failures |      1,044    .2643678    .6561418          0          3

. 
. * additional school educational support
. * additional family educational support
. * additional paid classes
. * extra-curricular activities
. * internet access at home
. * attended nursey school
. * wants to attend higher education
. * in a romantic relationship
. 
. local orig schoolsup    famsup       paid     activities internet      nursery     higher     romantic

. local new  sch_edu_supp fam_edu_supp paid_cls extracurr  home_internet att_nursery goal_hi_ed in_relation

. 
. assert `: word count `orig''==`: word count `new''

. 
. forvalues x = 1/`: word count `orig'' {
  2. 
.   local o : word `x' of `orig'
  3.   local n : word `x' of `new'
  4. 
.   assert inlist(`o', "no", "yes")
  5. 
.   gen `n' = `o'=="yes"
  6. 
.   tablist `n' `o', sort(v) ab(32)
  7. 
.   rename `o' __`o'
  8. 
. }

  +----------------------------------------------------------------+
  | sch_edu_supp   schoolsup   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------------|
  |            0          no      925    88.60       925     88.60 |
  |            1         yes      119    11.40      1044    100.00 |
  +----------------------------------------------------------------+

  +-------------------------------------------------------------+
  | fam_edu_supp   famsup   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------|
  |            0       no      404    38.70       404     38.70 |
  |            1      yes      640    61.30      1044    100.00 |
  +-------------------------------------------------------------+

  +-------------------------------------------------------+
  | paid_cls   paid   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------|
  |        0     no      824    78.93       824     78.93 |
  |        1    yes      220    21.07      1044    100.00 |
  +-------------------------------------------------------+

  +--------------------------------------------------------------+
  | extracurr   activities   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------|
  |         0           no      528    50.57       528     50.57 |
  |         1          yes      516    49.43      1044    100.00 |
  +--------------------------------------------------------------+

  +----------------------------------------------------------------+
  | home_internet   internet   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------------|
  |             0         no      217    20.79       217     20.79 |
  |             1        yes      827    79.21      1044    100.00 |
  +----------------------------------------------------------------+

  +-------------------------------------------------------------+
  | att_nursery   nursery   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------|
  |           0        no      209    20.02       209     20.02 |
  |           1       yes      835    79.98      1044    100.00 |
  +-------------------------------------------------------------+

  +-----------------------------------------------------------+
  | goal_hi_ed   higher   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------|
  |          0       no       89     8.52        89      8.52 |
  |          1      yes      955    91.48      1044    100.00 |
  +-----------------------------------------------------------+

  +--------------------------------------------------------------+
  | in_relation   romantic   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------|
  |           0         no      673    64.46       673     64.46 |
  |           1        yes      371    35.54      1044    100.00 |
  +--------------------------------------------------------------+

. 
. * SCALE: quality of family relationships (1 = very bad, 5 = excellent)
. * SCALE: free time after school (1 = very low, 5 = very high)
. * SCALE: go out with friends (1 = very low, 5 = very high)
. * SCALE: weekday alcohol consumption (1 = very low, 5 = very high)
. * SCALE: weekend alcohol consumption (1 = very low, 5 = very high)
. * SCALE: current health status (1 = very bad, 5 = very good)
. 
. local orig famrel       freetime     goout        Dalc          Walc          health

. local new  scl_fam_rel scl_free_time scl_go_frnds scl_alc_wkday scl_alc_wkend scl_health

. 
. assert `: word count `orig''==`: word count `new''

. 
. forvalues x = 1/`: word count `orig'' {
  2. 
.   local o : word `x' of `orig'
  3.   local n : word `x' of `new'
  4. 
.   assert inlist(`o', 1, 2, 3, 4, 5)
  5.   qui summ `o'
  6.   assert `r(min)'==1 & `r(max)'==5
  7. 
.   rename `o' `n'
  8. 
.   tablist `n', sort(v) ab(32)
  9. 
. }

  +---------------------------------------------------+
  | scl_fam_rel   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |---------------------------------------------------|
  |           1       30     2.87        30      2.87 |
  |           2       47     4.50        77      7.38 |
  |           3      169    16.19       246     23.56 |
  |           4      512    49.04       758     72.61 |
  |           5      286    27.39      1044    100.00 |
  +---------------------------------------------------+

  +-----------------------------------------------------+
  | scl_free_time   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------|
  |             1       64     6.13        64      6.13 |
  |             2      171    16.38       235     22.51 |
  |             3      408    39.08       643     61.59 |
  |             4      293    28.07       936     89.66 |
  |             5      108    10.34      1044    100.00 |
  +-----------------------------------------------------+

  +----------------------------------------------------+
  | scl_go_frnds   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------|
  |            1       71     6.80        71      6.80 |
  |            2      248    23.75       319     30.56 |
  |            3      335    32.09       654     62.64 |
  |            4      227    21.74       881     84.39 |
  |            5      163    15.61      1044    100.00 |
  +----------------------------------------------------+

  +-----------------------------------------------------+
  | scl_alc_wkday   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------|
  |             1      727    69.64       727     69.64 |
  |             2      196    18.77       923     88.41 |
  |             3       69     6.61       992     95.02 |
  |             4       26     2.49      1018     97.51 |
  |             5       26     2.49      1044    100.00 |
  +-----------------------------------------------------+

  +-----------------------------------------------------+
  | scl_alc_wkend   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------|
  |             1      398    38.12       398     38.12 |
  |             2      235    22.51       633     60.63 |
  |             3      200    19.16       833     79.79 |
  |             4      138    13.22       971     93.01 |
  |             5       73     6.99      1044    100.00 |
  +-----------------------------------------------------+

  +--------------------------------------------------+
  | scl_health   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------|
  |          1      137    13.12       137     13.12 |
  |          2      123    11.78       260     24.90 |
  |          3      215    20.59       475     45.50 |
  |          4      174    16.67       649     62.16 |
  |          5      395    37.84      1044    100.00 |
  +--------------------------------------------------+

. 
. * absences
. summ absences

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    absences |      1,044    4.434866    6.210017          0         75

. 
. assert `r(min)'==0 & `r(max)'==75

. 
. * pre-/post-test
. summ G1 G2 G3

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          G1 |      1,044     11.2136    2.983394          0         19
          G2 |      1,044    11.24617    3.285071          0         19
          G3 |      1,044    11.34195    3.864796          0         20

. 
. assert `r(min)'==0 & `r(max)'==20

. 
. rename G1 pre_test1

. rename G2 pre_test2

. rename G3 post_test

. 
. summ post_test, detail

                          post_test
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            8              0       Obs               1,044
25%           10              0       Sum of Wgt.       1,044

50%           11                      Mean           11.34195
                        Largest       Std. Dev.      3.864796
75%           14             19
90%           16             19       Variance       14.93665
95%           17             19       Skewness      -.9845475
99%           18             20       Kurtosis       4.730235

. 
. gen post_test_gtp25 = post_test>`r(p25)'

. gen post_test_gtp50 = post_test>`r(p50)'

. gen post_test_gtp75 = post_test>`r(p75)'

. 
. 
. /* output */
. drop __*

. 
. isid subj pseudo_id

. 
. order subj pseudo_id ///
>       school_GP female age urban famsize_4plus par_together guardian_* ///
>       m_edu_coll m_job_* ///
>       f_edu_coll f_job_* ///
>       sch_close sch_trvl_time_ge15m failures absences ///
>       wk_study_* *_edu_supp paid_cls extracurr home_internet att_nursery goal_hi_ed ///
>       in_relation scl_* ///
>       pre_test1 pre_test2 post_test post_test_gt*

. 
. save "`out_dta'", replace
file C:\Users\CTilley\Projects\portugal\src\final\student.dta saved

. export delimited using "`out_csv'", replace
file C:\Users\CTilley\Projects\portugal\src\final\student.csv saved

. 
. 
. 
. capture log close _all
